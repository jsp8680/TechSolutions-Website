<!DOCTYPE html>
<html>
<head>
  <title>Schedule Form</title>
  <style>
    /* Style the form for better visual appearance */
    form {
      width: 300px;
      margin: 0 auto;
      font-family: Arial, sans-serif;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="time"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    input[type="submit"] {
      width: 100%;
      padding: 10px;
      background-color: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    input[type="submit"]:hover {
      background-color: #45a049;
    }
  </style>
</head>
<button onclick="goBack()">Go Back</button>
<% if(user) {%>
<body>
  <form method="POST" action="/schedule">
    <h1>Schedule an Appointment</h1>
    <p>Please fill in this form to schedule an appointment.</p>

    
    <input type="hidden" id="email" name="email" value="<%= user.email %>" readonly>
    <label for="date">Date:</label>
    <input type="date" id="date" name="date" required>
    <div class="date error"></div>
    
    <label for="time">Time:</label>
    <input type="time" id="time" name="time" required>
    <div class="time error"></div>
    
    <label for="phone">Phone:</label>
    <input type="text" id="phone" name="phone" required>
    <div class="phone error"></div>

   

    <label for="serviceType">Service Type</label>
    <select id="serviceType" name="serviceType" required>
      <option value="Software Development Consultation">Software Development Consultation</option>
      <option value="Network Installation">Network Installation</option>
      <option value="Troubleshooting">Troubleshooting</option>
      <option value="Other">Other</option>
    </select>
    <div class="serviceType error"></div>
   
      
<br>
    <label for="description">Description:</label>
    <textarea id="description" name="description" rows="4" required></textarea>
    <div class="description error"></div>
    
    <input type="submit" value="Submit">
  </form>
  <% } else { %>
    <h1>Please Login or Sign Up to schedule an appointment</h1>
<a href="/login">Login</a>
<a href="/signup">Sign Up</a>
  <% } %>
</body>
<script>
   function goBack() {
    window.history.back();
  }

  const form = document.querySelector("form");
  const dateError = document.querySelector(".date.error");
  const timeError = document.querySelector(".time.error");
  const phoneError = document.querySelector(".phone.error");
  const serviceTypeError = document.querySelector(".serviceType.error");
  const descriptionError = document.querySelector(".description.error");

 
  form.addEventListener('submit', async (e) =>{
  e.preventDefault();

  // Reset errors
  dateError.textContent = "";
  timeError.textContent = "";
  phoneError.textContent = "";
  serviceTypeError.textContent = "";
  descriptionError.textContent = "";  

  // Get values
  const email = form.email.value;
  const date = form.date.value;
  const time = form.time.value;
  const phone = form.phone.value;
  const serviceType = form.serviceType.value;
  const description = form.description.value;

  try {
    const res = await fetch('/schedule',{
      method: "POST",
      body: JSON.stringify({email, date, time, phone, serviceType, description}),
      headers: {'Content-Type': 'application/json'}
    });

    const data = await res.json();
    console.log(data);
    if (data.errors) {
      dateError.textContent = data.errors.date;
      timeError.textContent = data.errors.time;
      phoneError.textContent = data.errors.phone;
      serviceTypeError.textContent = data.errors.serviceType;
      descriptionError.textContent = data.errors.description;
    }
    if (data.appointment) { // Update the condition to check for data.appointment
      location.assign("/");
    }
  } catch (err) {
    console.log(err);
  }
});

</script>
</html>
