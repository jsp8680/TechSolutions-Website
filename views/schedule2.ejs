
<head>
  <title>Schedule Form</title>
  <style>
    /* Style the form for better visual appearance */
    form {
      width: 300px;
      margin: 0 auto;
      font-family: Arial, sans-serif;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"],
    input[type="time"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    input[type="submit"] {
      width: 100%;
      padding: 10px;
      background-color: #536ae9;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #goBack {
  text-align: left;
  float: left;
}
    /* #goBack {
  margin-top: 0px;
  border-radius: 36px;
  background: #a6adbe;
  border:0;
  text-transform: uppercase;
  font-weight: 700;
  font-size: 0.8em;
  align-items: end;
  display: block;
  padding: 10px 16px;
  letter-spacing: 2px;
  margin-bottom: 10px;
  align-content: baseline;
    } */
    input[type="submit"]:hover {
      background-color: #6facf1;
    }
    .error {
      color: red;
      margin-bottom: 20px;
    }
    #else-header{
      text-align: center;
      font-size: 35px;
      color: #3096f7;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-weight: bold;
    }
    #else-login{
      align-self: center;
      font-size: 25px;
      color: #834de7;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-weight: bold;
    }
    #else-signUp{
      align-self: center;
      font-size: 25px;
      color: #834de7;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-weight: bold;
    }

  </style>
</head>


<body>
  <button id='goBack'onclick="goBack()">Go Back</button>
  <form method="POST" action="/schedule2">
    
    <h1>Schedule an Appointment</h1>
    <p>Please fill in this form to schedule an appointment.</p>
  
    
    <input type="hidden" id="email" name="email" value="<%= user.email %>" readonly>
    <label for="date">Date:</label>
    <input type="date" id="date" name="date" onchange="getAvailableTimes()"  onclick="weekendMessage()" required>
    <div class="date error"></div>
    <div class="weekend message"></div>
    
    <label for="time">Time:</label>
    <!-- <input type="time" id="time" name="time" required> -->
    <!-- create a select  thing that shows the times from the Controller-->
    <select id="time" name="time" required>
      
      </select>
     
    <div class="time error"></div>
    <div class="time message">
    
    </div>
    
    <label for="phone">Phone:</label>
    <input type="text" id="phone" name="phone" required>
    <div class="phone error"></div>

   

    <label for="serviceType">Service Type</label>
    <select id="serviceType" name="serviceType" required>
      <option value="Software Development Consultation">Software Development Consultation</option>
      <option value="Network Installation">Network Installation</option>
      <option value="Troubleshooting">Troubleshooting</option>
      <option value="Other">Other</option>
    </select>
    <div class="serviceType error"></div>
   

    <label for="description">Description:</label>
    <textarea id="description" name="description" rows="3" cols='35' required></textarea>
    <div class="description error"></div>
    
    <input id="submit-schedule" type="submit" value="Submit">
  </form>

    <h1 id="else-header">Please Login or Sign Up to schedule an appointment</h1>
<a id="else-login" href="/login">Login</a>
<a id="else-signUp" href="/signup">Sign Up</a>

</body>
<script>


// function to goBack to previous page
   function goBack() {
    window.history.back();
  }
  // function to display weekend message
  function weekendMessage(){
    // if date input is selected
    const dateInput = document.querySelector("#date");
    const weekendMessage = document.querySelector(".weekend.message");

    weekendMessage.textContent = "You can only schedule an appointment on a weekday.";
  }
  function getAvailableTimes() {
  const selectedDate = document.getElementById("date").value;

  // Create the URL with the selectedDate as a query parameter
  const url = `/schedule2?date=${selectedDate}`;

  // Make the GET request to the server
  fetch(url)
    .then(response => response.json())
    .then(data => {
      const availableTimes = data.availableTimes;
      
      // Update the select element with the available times
      const selectElement = document.getElementById("time");
      selectElement.innerHTML = ""; // Clear existing options
      
      // Add the available times as options
      availableTimes.forEach(time => {
        const option = document.createElement("option");
        option.value = time;
        option.textContent = time;
        selectElement.appendChild(option);
      });
    })
    .catch(error => {
      console.error(error);
    });
}

  // Get the form elements
  const form = document.querySelector("form");
  const dateError = document.querySelector(".date.error");
  const timeError = document.querySelector(".time.error");
  const phoneError = document.querySelector(".phone.error");
  const serviceTypeError = document.querySelector(".serviceType.error");
  const descriptionError = document.querySelector(".description.error");

 // Listen for a submit event
  form.addEventListener('submit', async (e) =>{
  e.preventDefault();

  // Reset errors
  dateError.textContent = "";
  timeError.textContent = "";
  phoneError.textContent = "";
  serviceTypeError.textContent = "";
  descriptionError.textContent = "";  

  // Get values
  const email = form.email.value;
  const date = form.date.value;
  const time = form.time.value;
  const phone = form.phone.value;
  const serviceType = form.serviceType.value;
  const description = form.description.value;

  try {
    // Send a POST request to the server
    const res = await fetch('/schedule2',{
      method: "POST",
      body: JSON.stringify({email, date, time, phone, serviceType, description}),
      headers: {'Content-Type': 'application/json'}
    });
    // Get the response body
    const data = await res.json();
    console.log(data);
    // Check if there are any validation errors
    if (data.errors) {
      dateError.textContent = data.errors.date;
      timeError.textContent = data.errors.time;
      phoneError.textContent = data.errors.phone;
      serviceTypeError.textContent = data.errors.serviceType;
      descriptionError.textContent = data.errors.description;
    }
    // Check if there is an appointment
    if (data.appointment) {
      location.assign("/");
    }
  } catch (err) {
    console.log(err);
  }
});

// Event listener to clear weekend message
document.addEventListener('click', (event) => {
    const dateInput = document.querySelector("#date");
    const weekendMessage = document.querySelector(".weekend.message");

    // Check if the clicked element is outside the date input
    if (!dateInput.contains(event.target)) {
      weekendMessage.textContent = "";
    }
  });


</script>

